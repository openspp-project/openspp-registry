<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="inherit_view_entitlement_tree" model="ir.ui.view">
        <field name="name">inherit_view_entitlement_tree</field>
        <field name="model">g2p.entitlement</field>
        <field name="priority">1</field>
        <field name="inherit_id" ref="g2p_programs.view_entitlement_tree" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='valid_until']" position="after">
                <field name="currency_id" column_invisible="1" />
                <field name="initial_amount" sum="total_initial_amount" />
            </xpath>
        </field>
    </record>

    <record id="inherit_view_entitlement_form" model="ir.ui.view">
        <field name="name">inherit_view_entitlement_form</field>
        <field name="model">g2p.entitlement</field>
        <field name="priority">1</field>
        <field name="inherit_id" ref="g2p_programs.view_entitlement_form" />
        <field name="arch" type="xml">
            <xpath expr="//button[@name='approve_entitlement']" position="attributes">
                <attribute
                    name="groups"
                >g2p_registry_base.group_g2p_admin,g2p_programs.g2p_program_manager,g2p_programs.g2p_finance_validator,spp_programs.approve_entitlement</attribute>
            </xpath>
            <xpath expr="//button[@name='approve_entitlement']" position="after">
                <button
                    type="object"
                    class="btn-danger"
                    icon="fa-thumbs-o-down"
                    name="reject_entitlement"
                    title="Reject entitlement"
                    invisible="state not in ('draft','pending_validation')"
                    string="Reject Entitlement"
                    groups="g2p_registry_base.group_g2p_admin,g2p_programs.g2p_program_manager,g2p_programs.g2p_finance_validator,spp_programs.reject_entitlement"
                />
                <button
                    type="object"
                    class="btn-primary"
                    icon="fa-repeat"
                    name="reset_to_pending"
                    title="Reset to Pending"
                    invisible="state != 'reject'"
                    string="Reset to Pending"
                    groups="g2p_registry_base.group_g2p_admin,g2p_programs.g2p_program_manager"
                />
            </xpath>
            <xpath expr="//field[@name='date_approved']" position="after">
                <field name="date_rejected" readonly="1" invisible="not date_rejected" />
                <field name="rejected_reason" readonly="1" invisible="not rejected_reason" />
            </xpath>
        </field>
    </record>

    <record id="g2p_programs.menu_entitlement" model="ir.ui.menu">
        <field name="groups_id" eval="[(4,ref('spp_programs.read_program_cycle_entitlement'))]" />
    </record>

    <record model="ir.actions.server" id="reject_entitlement_modal">
        <field name="name">Reject</field>
        <field name="model_id" ref="spp_programs.model_spp_reject_entitlement_wizard" />
        <field name="binding_model_id" ref="g2p_programs.model_g2p_entitlement" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">action = model.open_wizard()</field>
        <field
            name="groups_id"
            eval="[(4, ref('g2p_registry_base.group_g2p_admin')), (4, ref('g2p_programs.g2p_program_manager')), (4, ref('g2p_programs.g2p_finance_validator')), (4, ref('spp_programs.reject_entitlement'))]"
        />
    </record>

    <record id="g2p_programs.multiple_entitlement_approval" model="ir.actions.server">
        <field
            name="groups_id"
            eval="[(4, ref('g2p_registry_base.group_g2p_admin')), (4, ref('g2p_programs.g2p_program_manager'))]"
        />
    </record>

    <record model="ir.actions.server" id="reset_to_pending_entitlement_modal">
        <field name="name">Reset to Pending</field>
        <field name="model_id" ref="spp_programs.model_spp_reset_pending_entitlement_wizard" />
        <field name="binding_model_id" ref="g2p_programs.model_g2p_entitlement" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">action = model.open_wizard()</field>
        <field
            name="groups_id"
            eval="[(4, ref('g2p_registry_base.group_g2p_admin')), (4, ref('g2p_programs.g2p_program_manager'))]"
        />
    </record>
</odoo>
