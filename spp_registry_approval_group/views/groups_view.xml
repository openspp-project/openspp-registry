<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="inherit_view_groups_list_tree" model="ir.ui.view">
        <field name="name">inherit_view_groups_list_tree</field>
        <field name="model">res.partner</field>
        <field name="priority">100</field>
        <field name="inherit_id" ref="g2p_registry_group.view_groups_list_tree" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field
                    name="state"
                    widget="badge"
                    decoration-info="state == 'draft'"
                    decoration-success="state == 'approved'"
                    decoration-danger="state == 'rejected'"
                />
            </xpath>
        </field>
    </record>

    <record id="inherit_view_groups_form" model="ir.ui.view">
        <field name="name">inherit_view_groups_form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="g2p_registry_group.view_groups_form" />
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <header>
                    <button
                        name="approve_registry"
                        type="object"
                        string="Approve"
                        class="btn-success"
                        icon="fa-check"
                        title="Approve"
                        groups="spp_registry_approval.approve_registry"
                        invisible="state != 'draft'"
                        confirm="Are you sure you want to approve this registry?"
                    />
                    <button
                        name="reject_registry"
                        type="object"
                        string="Reject"
                        class="btn-danger"
                        icon="fa-times"
                        title="Reject"
                        groups="spp_registry_approval.reject_registry"
                        invisible="state != 'draft'"
                        confirm="Are you sure you want to reject this registry?"
                    />
                    <button
                        name="reset_to_draft_registry"
                        type="object"
                        string="Reset to Draft"
                        class="btn-primary"
                        icon="fa-repeat"
                        title="Reset to Draft"
                        groups="spp_registry_approval.reset_to_draft_registry"
                        invisible="state == 'draft'"
                        confirm="Are you sure you want to reset this registry back to draft?"
                    />

                    <field name="state" widget="statusbar" />
                </header>
            </xpath>
        </field>
    </record>

    <record id="g2p_registry_group.menu_groups_list" model="ir.ui.menu">
        <field name="groups_id" eval="[(4,ref('spp_registry_base.read_registry'))]" />
        <field name="action" eval="False" />
    </record>

    <!-- For All Groups -->
    <menuitem
        id="menu_all_groups_list"
        name="All Groups"
        action="g2p_registry_group.action_groups_list"
        parent="g2p_registry_group.menu_groups_list"
        sequence="10"
        groups="g2p_registry_base.group_g2p_admin,g2p_registry_base.group_g2p_registrar,spp_registry_base.read_registry"
    />

    <!-- For Draft Groups -->
    <record id="action_draft_groups_list" model="ir.actions.act_window">
        <field name="name">Draft Groups</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="g2p_registry_group.view_registry_groups_filter" />
        <field
            name="context"
        >{'default_is_registrant':True,'default_is_group':True,'registrant_form':True}</field>
        <field
            name="domain"
        >[('is_registrant', '=', True),('is_group','=',True),('state', '=', 'draft')]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new group registrant!
            </p><p>
                Click the create button to enter the new registrant's information.
            </p>
        </field>
    </record>

    <record id="action_draft_groups_list_tree_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">tree</field>
        <field name="view_id" ref="g2p_registry_group.view_groups_list_tree" />
        <field name="act_window_id" ref="action_draft_groups_list" />
    </record>

    <record id="action_draft_groups_form_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">form</field>
        <field name="view_id" ref="g2p_registry_group.view_groups_form" />
        <field name="act_window_id" ref="action_draft_groups_list" />
    </record>

    <menuitem
        id="menu_draft_groups_list"
        name="Draft Groups"
        action="action_draft_groups_list"
        parent="g2p_registry_group.menu_groups_list"
        sequence="15"
        groups="g2p_registry_base.group_g2p_admin,g2p_registry_base.group_g2p_registrar,spp_registry_base.read_registry"
    />

    <!-- For Approved Groups -->
    <record id="action_approve_groups_list" model="ir.actions.act_window">
        <field name="name">Approved Groups</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="g2p_registry_group.view_registry_groups_filter" />
        <field
            name="context"
        >{'default_is_registrant':True,'default_is_group':True,'registrant_form':True,'create':False,'edit':False}</field>
        <field
            name="domain"
        >[('is_registrant', '=', True),('is_group','=',True),('state', '=', 'approved')]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new group registrant!
            </p><p>
                Click the create button to enter the new registrant's information.
            </p>
        </field>
    </record>

    <record id="action_approve_groups_list_tree_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">tree</field>
        <field name="view_id" ref="g2p_registry_group.view_groups_list_tree" />
        <field name="act_window_id" ref="action_approve_groups_list" />
    </record>

    <record id="action_approve_groups_form_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">form</field>
        <field name="view_id" ref="g2p_registry_group.view_groups_form" />
        <field name="act_window_id" ref="action_approve_groups_list" />
    </record>

    <menuitem
        id="menu_approve_groups_list"
        name="Approved Groups"
        action="action_approve_groups_list"
        parent="g2p_registry_group.menu_groups_list"
        sequence="20"
        groups="g2p_registry_base.group_g2p_admin,g2p_registry_base.group_g2p_registrar,spp_registry_base.read_registry"
    />

    <!-- For Rejected Groups -->
    <record id="action_rejected_groups_list" model="ir.actions.act_window">
        <field name="name">Rejected Groups</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="g2p_registry_group.view_registry_groups_filter" />
        <field
            name="context"
        >{'default_is_registrant':True,'default_is_group':True,'registrant_form':True,'create':False,'edit':False}</field>
        <field
            name="domain"
        >[('is_registrant', '=', True),('is_group','=',True),('state', '=', 'rejected')]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new group registrant!
            </p><p>
                Click the create button to enter the new registrant's information.
            </p>
        </field>
    </record>

    <record id="action_rejected_groups_list_tree_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">tree</field>
        <field name="view_id" ref="g2p_registry_group.view_groups_list_tree" />
        <field name="act_window_id" ref="action_rejected_groups_list" />
    </record>

    <record id="action_rejected_groups_form_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">form</field>
        <field name="view_id" ref="g2p_registry_group.view_groups_form" />
        <field name="act_window_id" ref="action_rejected_groups_list" />
    </record>

    <menuitem
        id="menu_rejected_groups_list"
        name="Rejected Groups"
        action="action_rejected_groups_list"
        parent="g2p_registry_group.menu_groups_list"
        sequence="25"
        groups="g2p_registry_base.group_g2p_admin,g2p_registry_base.group_g2p_registrar,spp_registry_base.read_registry"
    />
</odoo>
